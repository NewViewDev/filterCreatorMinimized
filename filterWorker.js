function findColorIndx(t,e,a,n,o){let l=4*e[0],r=4*e[1]*a;if(!(r+t<0||r+t>=n||l+t<0||l+t>=n))return t+r+l+o}importScripts("./mathjs/lib/browser/math.js"),onmessage=function(t){let e=t.data[0],a=t.data[1],n=(t.data[2],t.data[3]),o=t.data[4],l=t.data[4],r=t.data[5],i=e.length,d=new ArrayBuffer(r-l),f=new Uint8ClampedArray(d),s=new Uint32Array(d);s[1]=168496141;var c=!0;10===d[4]&&11===d[5]&&12===d[6]&&13===d[7]&&(LittleEndian=!1);let u=3,g="0";function m(t){let o=[0,0,0,e[t+3]];for(let l=0;l<u;++l){let r="";for(let o of a[l]){let a=o.type;if("square"===a){let a=findColorIndx(t,o.loc,n,i,o.color);void 0===e[a]?(console.log("Undefined pixel location: "+a.toString()),r+=g):r+=e[a]}"sign"!==a&&"value"!==a||(r+=o.info)}o[l]=math.evaluate(r)}s[(t-l)/4]=c?o[3]<<24|o[2]<<16|o[1]<<8|o[0]:o[0]<<24|o[1]<<16|o[2]<<8|o[3]}for(;o<r;)m(o),o+=4;postMessage([f,l]);close();};
