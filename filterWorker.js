function findColorIndx(t,a,e,o,r){let n=4*a[0],l=4*a[1]*e;if(!(l+t<0||l+t>=o||n+t<0||n+t>=o))return t+l+n+r}importScripts("./mathjs/lib/browser/math.js"),onmessage=function(t){let a=t.data[0],e=t.data[1],o=(t.data[2],t.data[3]),r=t.data[4],n=t.data[4],l=t.data[5],i=a.length,f=new ArrayBuffer(l-n),d=new Uint8ClampedArray(f),s=new Uint32Array(f);s[1]=168496141;var u=!0;10===f[4]&&11===f[5]&&12===f[6]&&13===f[7]&&(u=!1);let c=3,m="0";function p(t){let r=[0,0,0,a[t+3]];for(let n=0;n<c;++n){let l="";for(let r of e[n]){let e=r.type;if("square"===e){let e=findColorIndx(t,r.loc,o,i,r.color),n=[];void 0===a[e]?(n.push(e),l+=m):l+=a[e]}"sign"!==e&&"value"!==e||(l+=r.info)}r[n]=math.evaluate(l)}s[(t-n)/4]=u?r[3]<<24|r[2]<<16|r[1]<<8|r[0]:r[0]<<24|r[1]<<16|r[2]<<8|r[3]}for(;r<l;)p(r),r+=4;postMessage([d,n]),close()};
