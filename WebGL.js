let imageData;console.log("Loaded WebGL.js");var imageWidth=void 0,imageHeight=void 0;function supportsWebGL(){try{var e=document.createElement("canvas");return!!window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch(e){return!1}}const vsSource="\n  attribute vec4 aVertexPosition;\n  attribute vec2 aTextureCoord;\n\n  varying highp vec2 vTextureCoord;\n\n  void main(void) {\n    gl_Position = aVertexPosition;\n    vTextureCoord = aTextureCoord;\n  }\n";var fsSource="\n  precision lowp float;\n  varying highp vec2 vTextureCoord;\n  uniform vec2 u_textureSize;\n\n  uniform sampler2D uSampler;\n  vec4 shift = vec4(0.1,0.0,0.0,0.0);\n\n  void main(void) {\n    vec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n\n    gl_FragColor = vec4(0.0,0.0,0.0,1.0);\n  }\n";function fsSetup(e){if(0===e[0].length&&0===e[1].length&&0===e[2].length)return fsSource;let t="\n    precision lowp float;\n    varying highp vec2 vTextureCoord;\n    uniform vec2 u_textureSize;\n\n    uniform sampler2D uSampler;\n    vec4 shift = vec4(0.1,0.0,0.0,0.0);\n\n    void main(void) {\n      vec2 onePixel = vec2(1.0, 1.0) / u_textureSize;\n      vec4 sum = vec4(0.0, 0.0, 0.0, 1.0);\n\n  ";for(let r=0;r<e.length;++r){let o;o=0===r?"r":1===r?"g":"b";for(let i of e[r])t+=`sum.${o} += texture2D(uSampler, vTextureCoord + onePixel * vec2(${i.loc.toString()})).${i.color};`}return t+="gl_FragColor = sum;}"}function filterGL(e,t,r){fsSource=fsSetup(r,fsSource),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0);const o=initBuffers(e),i=initShaderProgram(e,vsSource,fsSource),n={program:i,attribLocations:{vertexPosition:e.getAttribLocation(i,"aVertexPosition"),textureCoord:e.getAttribLocation(i,"aTextureCoord")},uniformLocations:{projectionMatrix:e.getUniformLocation(i,"uProjectionMatrix"),modelViewMatrix:e.getUniformLocation(i,"uModelViewMatrix"),uSampler:e.getUniformLocation(i,"uSampler"),textureSizeLocation:e.getUniformLocation(i,"u_textureSize")}};loadTexture(e,t,n,o)}function initBuffers(e){const t=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,t);e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,1,1,-1,1]),e.STATIC_DRAW);const r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r);e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),e.STATIC_DRAW);const o=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o);return e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),e.STATIC_DRAW),{position:t,textureCoord:r,indices:o}}function loadTexture(e,t,r,o){const i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i);const n=e.RGBA,a=e.RGBA,c=e.UNSIGNED_BYTE,u=new Uint8Array([0,0,0,255]);e.texImage2D(e.TEXTURE_2D,0,n,1,1,0,a,c,u);const s=new Image;return s.onload=function(){e.canvas.width=s.width,e.canvas.height=s.height;e.canvas.style.width=(s.width/s.height*600).toString()+"px",e.canvas.style.height=600..toString()+"px",e.viewport(0,0,e.canvas.width,e.canvas.height),e.bindTexture(e.TEXTURE_2D,i),e.texImage2D(e.TEXTURE_2D,0,n,a,c,s),isPowerOf2(s.width)&&isPowerOf2(s.height)?e.generateMipmap(e.TEXTURE_2D):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR)),drawScene(e,r,o,i),B_download.style.display="block"},s.src=t,imageWidth=s.width,imageHeight=s.height,i}function isPowerOf2(e){return 0==(e&e-1)}function drawScene(e,t,r,o){e.clearColor(0,0,0,1),e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);const i=45*Math.PI/180,n=e.canvas.clientWidth/e.canvas.clientHeight,a=mat4.create();mat4.perspective(a,i,n,.1,100);const c=mat4.create();mat4.translate(c,c,[0,0,-3]);{const o=2,i=e.FLOAT,n=!1,a=0,c=0;e.bindBuffer(e.ARRAY_BUFFER,r.position),e.vertexAttribPointer(t.attribLocations.vertexPosition,o,i,n,a,c),e.enableVertexAttribArray(t.attribLocations.vertexPosition)}{const o=2,i=e.FLOAT,n=!1,a=0,c=0;e.bindBuffer(e.ARRAY_BUFFER,r.textureCoord),e.vertexAttribPointer(t.attribLocations.textureCoord,o,i,n,a,c),e.enableVertexAttribArray(t.attribLocations.textureCoord)}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.indices),e.useProgram(t.program),e.uniformMatrix4fv(t.uniformLocations.projectionMatrix,!1,a),e.uniformMatrix4fv(t.uniformLocations.modelViewMatrix,!1,c),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,o),e.uniform1i(t.uniformLocations.uSampler,0),e.uniform2f(t.uniformLocations.textureSizeLocation,imageWidth,imageHeight);{const t=6,r=e.UNSIGNED_SHORT,o=0;e.drawElements(e.TRIANGLE_STRIP,t,r,o),imageData=e.canvas.toDataURL("image/png",1)}}function initShaderProgram(e,t,r){const o=loadShader(e,e.VERTEX_SHADER,t),i=loadShader(e,e.FRAGMENT_SHADER,r),n=e.createProgram();return e.attachShader(n,o),e.attachShader(n,i),e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS)?n:(alert("Unable to initialize the shader program: "+e.getProgramInfoLog(n)),null)}function loadShader(e,t,r){const o=e.createShader(t);return e.shaderSource(o,r),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS)?o:(alert("An error occurred compiling the shaders: "+e.getShaderInfoLog(o)),e.deleteShader(o),null)}
